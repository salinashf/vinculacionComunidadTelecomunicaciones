<form class="form-panel">
    <div class="row">
        <div class=" col-lg-3 justify-content-center">
            <img src='images/logoUIsrael3.png'/>
        </div>
        <div class=" col-lg-3 justify-content-center">
            <h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE QPSK</b></h6>
            <h6 class="text-justify">
                Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide)
                entre dos valores posibles.
            </h6>
            <div class="text-right ">
                <button class="btn btn-labeled btn-primary" id="qpskRedraw" type="button">
                    <span class="btn-label"><i class="fa fa-check" id="qpskRedrawIcon"></i></span>|graficar
                </button>
            </div>
        </div>
        <div class="col-lg-6 text-center">
            <div class="row label-section-top ">
                <div class="col-lg-4 nopadding text-center">
                    <span class="badge badge-danger">SEÑAL PORTADORA</span>
                </div>
                <div class="col-lg-5 nopadding text-center">
                    <span class="badge badge-info">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEÑAL MODULADORA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-2 text-center">
                    <input id="QPSKAmp" type="text" value="1"/>
                    <span class="badge badge-warning">Amplitud</span>
                </div>
                <div class="col-lg-2 text-center">
                    <input id="QPSKFrec" type="text" value="1"/>
                    <span class="badge badge-success">Frecuencia</span>
                </div>
                <div class="col-lg-2 text-center">
                    <input id="QPSKAmpI" type="text" value="1"/>
                    <span class="badge badge-warning">Amplitud  I</span>
                </div>
                <div class="col-lg-3 text-left">
                     <span class="badge badge-success fontSize">Freq.Q:<span class="badge badge-light fontSize"
                                                                             id="freqQQPSK">0.25kHz</span></span>
                    <span class="badge badge-success fontSize">Freq.I:<span class="badge badge-light fontSize"
                                                                            id="freqIQPSK">0.5kHz</span></span>

                    <span class="badge badge-warning fontSize">Amp. Q:<span class="badge badge-light fontSize"
                                                                            id="ampQQPSK">1v</span></span>
                </div>
            </div>
        </div>
    </div>
</form>
<div style="overflow-y: scroll; overflow-x: hidden; height: 400px; width: auto">
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_PortSen'/>
        <div class="col-lg-2">
         <span>
          <h5>Portadora Seno</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_BitI'/>
        <div class="col-lg-2">
         <span>
          <h5>Bit I</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_PortCos'/>
        <div class="col-lg-2">
         <span>
          <h5>Portadora Coseno</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_BitQ'/>
        <div class="col-lg-2">
         <span>
          <h5>Bit Q</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_CanalI'/>
        <div class="col-lg-2">
         <span>
          <h5>Canal I</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_CanalQ'/>
        <div class="col-lg-2">
         <span>
          <h5>Canal Q</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_QPSK'/>
        <div class="col-lg-2">
         <span>
          <h5>QPSK</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpsk_MIX'/>
        <div class="col-lg-2">
                 <span>
                  <h5>Bit I/Canal I</h5>
                       <h6 class="text-justify">
                           Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
                       </h6>
                </span>
            <h6 class='text-center' id="legendMix"/>
        </div>
    </div>

    <div class='row trunk-section'>
        <div class='col-lg-10' id='qpskbiti_MIX'/>
        <div class="col-lg-2">
                 <span>
                  <h5>Bit I / QPSK</h5>
                       <h6 class="text-justify">
                           Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
                       </h6>
                </span>
            <h6 class='text-center' id="legendqpskbitiMix"/>
        </div>
    </div>


</div>

<script>
    'use strict';
    var dwQPSKEnd = 0;

    function completo() {
        if (dwQPSKEnd = 9) {
            dismiss();
            $("#qpskRedrawIcon").removeClass().addClass('fa fa-check');
        }
    }

/*    var amp_port = $("#amp_port");
    var amp_i = $("#amp_i");
    var amp_q = $("#amp_q");
    var freq_port = $("#freq_port");
    var freq_i = $("#freq_i");
    var freq_q = $("#freq_q");*/

    var valeQPSKAmp = $("#QPSKAmp");
    var valeQPSKAmpI = $("#QPSKAmpI");
        var valeQPSKAmpQ = $("#ampQQPSK");
    var valeQPSKFreq = $("#QPSKFrec");
        var valefreqIQPSK = $("#freqIQPSK");
        var valefreqQQPSK = $("#freqQQPSK");


    $('#qpskRedraw ').click(function () {
        $("#qpskRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(false,
                limpiarControles(valeQPSKAmp),
                limpiarControles(valeQPSKAmpI),
                limpiarControles(valeQPSKAmpQ),
                limpiarControles(valeQPSKFreq),
                limpiarControles(valefreqIQPSK),
                limpiarControles(valefreqQQPSK)
            )
        }, 10);
    });


    var porSen_QPSK = {
        /*title: "PORT. SEN",
        description: "El término comunicaciones digitales abarca un área extensa de técnicas de comunicaciones, incluyendo transmisión digital y radio digital. La transmisión digital es la transmisión de pulsos digitales, entre dos o más puntos, de un sistema de comunicación. El radio digital es la transmisión de portadoras analógicas moduladas, en forma digital, entre dos o más puntos de un sistema de comunicación.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [8],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_PortSen',
        x_accessor: 'Tiempo',
        y_accessor: 'PortSen',
        x_label: 'Tiempo',
        y_label: 'PortSen',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var porCos_QPSK = {
        /*title: "PORT. COS",
        description: "Una onda portadora es una onda, generalmente senoidal, modificada en alguno de sus parámetros (amplitud, frecuencia o fase) por una señal de entrada denominada moduladora con el fin de transmitir una información.1​ Esta onda portadora es de una frecuencia mucho más alta que la de la señal moduladora.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [6],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_PortCos',
        x_accessor: 'Tiempo',
        y_accessor: 'PortCos',
        x_label: 'Tiempo',
        y_label: 'PortCos',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var BitI_QPSK = {
        /*title: "BIT I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [1],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_BitI',
        x_accessor: 'Tiempo',
        y_accessor: 'BitI',
        x_label: 'Tiempo',
        y_label: 'BitI',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var BitQ_QPSK = {
        /*title: "BIT Q",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [0],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_BitQ',
        x_accessor: 'Tiempo',
        y_accessor: 'BitQ',
        x_label: 'Tiempo',
        y_label: 'BitQ',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };


    var CanalI_QPSK = {
        /*title: "CANAL I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [4],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_CanalI',
        x_accessor: 'Tiempo',
        y_accessor: 'CanalI',
        x_label: 'Tiempo',
        y_label: 'CanalI',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var CanalQ_QPSK = {
        /*title: "CANAL Q",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [7],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_CanalQ',
        x_accessor: 'Tiempo',
        y_accessor: 'CanalQ',
        x_label: 'Tiempo',
        y_label: 'CanalQ',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var qpsk_QPSK = {
        /*title: "QPSK",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [9],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_QPSK',
        x_accessor: 'Tiempo',
        y_accessor: 'QPSK',
        x_label: 'Tiempo',
        y_label: 'QPSK',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var bitICanalI_QPSK = {
        /*title: "BIT I/CANAL I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [4, 1],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_MIX',
        x_accessor: 'Tiempo',
        y_accessor: 'Combinacion',
        x_label: 'Tiempo',
        y_label: 'BIT T/CANAL I',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false,
        legend: ['BIT I', 'CANAL I'],
        legend_target: '#legendMix'
    };

    var bitI_QPSK_MIX = {
        /*title: "BIT I/CANAL I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [4, 9],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpskbiti_MIX',
        x_accessor: 'Tiempo',
        y_accessor: 'Combinacion',
        x_label: 'Tiempo',
        y_label: 'BIT T/QPSK',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false,
        legend: ['BIT I', 'QPSK'],
        legend_target: '#legendqpskbitiMix'
    };





    function dibujar(redibujar, ampPort, ampI, ampQ, freqPort, freqI, freqQ) {

        dwQPSKEnd = 0;

        let TiempoMin = 0;
        let TiempoMax = 1440;

        let porSen = 0;
        let porCos = 0;
        let bitI = 0;
        let bitQ = 0;
        let canalI = 0;
        let canalQ = 0;
        let qpsk_join = 0;
        let dataQPSK = [];
        let dataBitI = [];
        let dataCanalI = [];
        let dataMixQPSK = [];
        let Tiempo;
        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            porSen = (ampPort) * SIN(RADIANS(Tiempo * freqPort)); /// =$B$3*SIN(RADIANS(A7*$B$4))
            porCos = (ampPort) * COS(RADIANS(Tiempo * freqPort));// =$B$3*COS(RADIANS(A7*$B$4))
            bitI = (ampI) * SIN(RADIANS(Tiempo * freqI)) > 0 ? ampI : ampI * (-1); // =IF($C$3*SIN(RADIANS($C$4*A8))>0,C$3,-C$
            bitQ = (ampQ) * SIN(RADIANS(Tiempo * freqQ)) > 0 ? ampQ : ampQ * (-1); //IF($D$3*SIN(RADIANS($D$4*A7))>0,D$3,-D$3)
            canalI = porSen * bitI;
            canalQ = porCos * bitQ;
            qpsk_join = canalI + canalQ;


            dataQPSK.push({
                "Tiempo": Tiempo,
                "PortSen": porSen,
                "PortCos": porCos,
                "BitI": bitI,
                "BitQ": bitQ,
                "CanalI": canalI,
                "CanalQ": canalQ,
                "QPSK": qpsk_join
            });
            dataBitI.push({
                "Tiempo": Tiempo,
                "Combinacion": bitI
            });
            dataCanalI.push({
                "Tiempo": Tiempo,
                "Combinacion": canalI
            });
            dataMixQPSK.push({
                "Tiempo": Tiempo,
                "Combinacion": qpsk_join
            });

        }

        delete porSen_QPSK.data;
        delete porCos_QPSK.data;
        delete BitI_QPSK.data;
        delete BitQ_QPSK.data;
        delete CanalI_QPSK.data;
        delete CanalQ_QPSK.data;
        delete qpsk_QPSK.data;
        delete bitICanalI_QPSK.data;
        delete bitI_QPSK_MIX.data;


        porSen_QPSK.data = dataQPSK;
        porCos_QPSK.data = dataQPSK;
        BitI_QPSK.data = dataQPSK;
        BitQ_QPSK.data = dataQPSK;
        CanalI_QPSK.data = dataQPSK;
        CanalQ_QPSK.data = dataQPSK;
        qpsk_QPSK.data = dataQPSK;
        bitICanalI_QPSK.data = [dataCanalI, dataBitI];
        bitI_QPSK_MIX.data = [dataBitI, dataMixQPSK];


        MG.data_graphic(porSen_QPSK);
        MG.data_graphic(porCos_QPSK);
        MG.data_graphic(BitI_QPSK);
        MG.data_graphic(BitQ_QPSK);
        MG.data_graphic(CanalI_QPSK);
        MG.data_graphic(CanalQ_QPSK);
        MG.data_graphic(qpsk_QPSK);
        MG.data_graphic(bitICanalI_QPSK);
        MG.data_graphic(bitI_QPSK_MIX);


        d3.select("#qpsk_PortSen").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_BitI").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_PortCos").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_BitQ").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_CanalI").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });

        d3.select("#qpsk_CanalQ").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_QPSK").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_MIX").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpskbiti_MIX").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
    }

    (function () {
        $("#QPSKAmp ,#QPSKAmpI").knob(
            {
                "displayPrevious": true,
                "fgColor": "#5fa736",
                "inputColor": "#fe081c",
                "thickness": .2,
                "width": 50,
                "height": 50,
                'format': formatAmplitud,
                "release": function (value) {
                    let freq = parseInt(limpiarControles(valeQPSKAmpI));
                    valeQPSKAmpQ.text(freq + "v");
                }
            }
        );
        valeQPSKFreq.knob(
            {
                "displayPrevious": true,
                "fgColor": "#23b3ae",
                "inputColor": "#fe081c",
                "thickness": .2,
                "width": 50,
                "height": 50,
                "release": function (value) {
                    let freq = parseInt(limpiarControles(valeQPSKFreq));
                    valefreqIQPSK.text((freq / 2) + "kHz");
                    valefreqQQPSK.text((freq / 4) + "kHz");
                },
                "format": formatFrecuencia
            }
        );
        loading();
        dibujar(false, limpiarControles(valeQPSKAmp),
            limpiarControles(valeQPSKAmpI),
            limpiarControles(valeQPSKAmpQ),
            limpiarControles(valeQPSKFreq),
            limpiarControles(valefreqIQPSK),
            limpiarControles(valefreqQQPSK)
        );
    })();
</script>
