<form class="form-panel">
    <div class="row">
        <div class=" col-lg-3 justify-content-center">
            <img src='images/logoUIsrael3.png'/>
        </div>
        <div class=" col-lg-4 justify-content-center">
            <h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE QPSK</b></h6>
            <h6 class="text-justify">
                Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide)
                entre dos valores posibles.
            </h6>
            <div class="text-right ">
                <button class="btn btn-labeled btn-primary" id="qpskRedraw" type="button">
                    <span class="btn-label"><i class="fa fa-check" id="qpskRedrawIcon"></i></span>|graficar
                </button>
            </div>
        </div>
        <div class="col-lg-4 text-center">
            <!--los controles-->
            <div class="row">
                <div class=" col-lg-3 text-right">
                    <h6><b>x</b></h6>
                </div>
                <div class=" col-lg-3 text-center">
                    <h6><b>PORTADORA</b></h6>
                </div>
                <div class=" col-lg-3 text-center">
                    <h6><b> Moduladora I</b></h6>
                </div>
                <div class=" col-lg-3 text-center">
                    <h6><b>Moduladora Q</b></h6>
                </div>
            </div>
            <div class="row">
                <div class=" col-lg-3 text-right">
                    <h6><b>AMP</b></h6>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" id="amp_port" max="50" min="1"
                           step="1"
                           type="number"
                           value="1"/>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" id="amp_i" max="50" min="1" step="1"
                           type="number"
                           value="1"/>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" disabled="true" id="amp_q"
                           type="number"
                           value="1"/>
                </div>
            </div>
            <div class="row">
                <div class=" col-lg-3 text-right">
                    <h6><b>FREQ</b></h6>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" id="freq_port" max="50" min="1"
                           step="1"
                           type="number"
                           value="1"/>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" disabled="true" id="freq_i" max="50"
                           type="number"
                           value="0.5"/>
                </div>
                <div class=" col-lg-3 text-center">
                    <input class="validate form-control " data-validate="required" disabled="true" id="freq_q"
                           type="number"
                           value="0.25"/>
                </div>
            </div>
        </div>
    </div>
</form>


<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_PortSen'/>
    <div class="col-lg-2">
         <span>
          <h5>Portadora Seno</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_BitI'/>
    <div class="col-lg-2">
         <span>
          <h5>Bit I</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_PortCos'/>
    <div class="col-lg-2">
         <span>
          <h5>Portadora Coseno</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_BitQ'/>
    <div class="col-lg-2">
         <span>
          <h5>Bit Q</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_CanalI'/>
    <div class="col-lg-2">
         <span>
          <h5>Canal I</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_CanalQ'/>
    <div class="col-lg-2">
         <span>
          <h5>Canal Q</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>


<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_QPSK'/>
    <div class="col-lg-2">
         <span>
          <h5>QPSK</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>


<div class='row trunk-section'>
    <div class='col-lg-10' id='qpsk_MIX'/>
    <div class="col-lg-2">
                 <span>
                  <h5>Bit I/Canal I</h5>
                       <h6 class="text-justify">
                           Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
                       </h6>
                </span>
        <h6 class='text-center' id="legendMix"/>
    </div>
</div>

<script>
    'use strict';
    var dwQPSKEnd = 0;

    function completo() {
        if (dwQPSKEnd = 8) {
            dismiss();
            $("#qpskRedrawIcon").removeClass().addClass('fa fa-check');
        }
    }

    var amp_port = $("#amp_port");
    var amp_i = $("#amp_i");
    var amp_q = $("#amp_q");
    var freq_port = $("#freq_port");
    var freq_i = $("#freq_i");
    var freq_q = $("#freq_q");

    $('#freq_port,#amp_i').change(function () {
        freq_i.val(parseInt(freq_port.val()) / 2);
        freq_q.val(parseInt(freq_i.val()) / 2);
        amp_q.val(parseInt(amp_i.val()));
    });
    $('#qpskRedraw ').click(function () {
        $("#qpskRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(false, amp_port.val(), amp_i.val(), amp_q.val(), freq_port.val(), freq_i.val(), freq_q.val())
        }, 10);
    });


    var porSen_QPSK = {
        /*title: "PORT. SEN",
        description: "El término comunicaciones digitales abarca un área extensa de técnicas de comunicaciones, incluyendo transmisión digital y radio digital. La transmisión digital es la transmisión de pulsos digitales, entre dos o más puntos, de un sistema de comunicación. El radio digital es la transmisión de portadoras analógicas moduladas, en forma digital, entre dos o más puntos de un sistema de comunicación.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [8],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_PortSen',
        x_accessor: 'Tiempo',
        y_accessor: 'PortSen',
        x_label: 'Tiempo',
        y_label: 'PortSen',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var porCos_QPSK = {
        /*title: "PORT. COS",
        description: "Una onda portadora es una onda, generalmente senoidal, modificada en alguno de sus parámetros (amplitud, frecuencia o fase) por una señal de entrada denominada moduladora con el fin de transmitir una información.1​ Esta onda portadora es de una frecuencia mucho más alta que la de la señal moduladora.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [6],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_PortCos',
        x_accessor: 'Tiempo',
        y_accessor: 'PortCos',
        x_label: 'Tiempo',
        y_label: 'PortCos',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var BitI_QPSK = {
        /*title: "BIT I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [1],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_BitI',
        x_accessor: 'Tiempo',
        y_accessor: 'BitI',
        x_label: 'Tiempo',
        y_label: 'BitI',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var BitQ_QPSK = {
        /*title: "BIT Q",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [0],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_BitQ',
        x_accessor: 'Tiempo',
        y_accessor: 'BitQ',
        x_label: 'Tiempo',
        y_label: 'BitQ',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };


    var CanalI_QPSK = {
        /*title: "CANAL I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [4],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_CanalI',
        x_accessor: 'Tiempo',
        y_accessor: 'CanalI',
        x_label: 'Tiempo',
        y_label: 'CanalI',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var CanalQ_QPSK = {
        /*title: "CANAL Q",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [7],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_CanalQ',
        x_accessor: 'Tiempo',
        y_accessor: 'CanalQ',
        x_label: 'Tiempo',
        y_label: 'CanalQ',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var qpsk_QPSK = {
        /*title: "QPSK",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [9],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_QPSK',
        x_accessor: 'Tiempo',
        y_accessor: 'QPSK',
        x_label: 'Tiempo',
        y_label: 'QPSK',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var bitICanalI_QPSK = {
        /*title: "BIT I/CANAL I",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [4, 1],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#qpsk_MIX',
        x_accessor: 'Tiempo',
        y_accessor: 'Combinacion',
        x_label: 'Tiempo',
        y_label: 'BIT T/CANAL I',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false,
        legend: ['BIT I', 'CANAL I'],
        legend_target: '#legendMix'
    };

    function dibujar(redibujar, ampPort, ampI, ampQ, freqPort, freqI, freqQ) {

        dwQPSKEnd = 0;

        let TiempoMin = 0;
        let TiempoMax = 1440;

        let porSen = 0;
        let porCos = 0;
        let bitI = 0;
        let bitQ = 0;
        let canalI = 0;
        let canalQ = 0;
        let qpsk_join = 0;
        let dataQPSK = [];
        let dataBitI = [];
        let dataCanalI = [];

        let Tiempo;
        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            porSen = (ampPort) * SIN(RADIANS(Tiempo * freqPort)); /// =$B$3*SIN(RADIANS(A7*$B$4))
            porCos = (ampPort) * COS(RADIANS(Tiempo * freqPort));// =$B$3*COS(RADIANS(A7*$B$4))
            bitI = (ampI) * SIN(RADIANS(Tiempo * freqI)) > 0 ? ampI : ampI * (-1); // =IF($C$3*SIN(RADIANS($C$4*A8))>0,C$3,-C$
            bitQ = (ampQ) * SIN(RADIANS(Tiempo * freqQ)) > 0 ? ampQ : ampQ * (-1); //IF($D$3*SIN(RADIANS($D$4*A7))>0,D$3,-D$3)
            canalI = porSen * bitI;
            canalQ = porCos * bitQ;
            qpsk_join = canalI + canalQ;


            dataQPSK.push({
                "Tiempo": Tiempo,
                "PortSen": porSen,
                "PortCos": porCos,
                "BitI": bitI,
                "BitQ": bitQ,
                "CanalI": canalI,
                "CanalQ": canalQ,
                "QPSK": qpsk_join
            });
            dataBitI.push({
                "Tiempo": Tiempo,
                "Combinacion": bitI
            });
            dataCanalI.push({
                "Tiempo": Tiempo,
                "Combinacion": canalI
            });


        }

        delete porSen_QPSK.data;
        delete porCos_QPSK.data;
        delete BitI_QPSK.data;
        delete BitQ_QPSK.data;
        delete CanalI_QPSK.data;
        delete CanalQ_QPSK.data;
        delete qpsk_QPSK.data;
        delete bitICanalI_QPSK.data;


        porSen_QPSK.data = dataQPSK;
        porCos_QPSK.data = dataQPSK;
        BitI_QPSK.data = dataQPSK;
        BitQ_QPSK.data = dataQPSK;
        CanalI_QPSK.data = dataQPSK;
        CanalQ_QPSK.data = dataQPSK;
        qpsk_QPSK.data = dataQPSK;
        bitICanalI_QPSK.data = [dataCanalI, dataBitI];


        MG.data_graphic(porSen_QPSK);
        MG.data_graphic(porCos_QPSK);
        MG.data_graphic(BitI_QPSK);
        MG.data_graphic(BitQ_QPSK);
        MG.data_graphic(CanalI_QPSK);
        MG.data_graphic(CanalQ_QPSK);
        MG.data_graphic(qpsk_QPSK);
        MG.data_graphic(bitICanalI_QPSK);


        d3.select("#qpsk_PortSen").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_BitI").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_PortCos").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_BitQ").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_CanalI").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });

        d3.select("#qpsk_CanalQ").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_QPSK").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });
        d3.select("#qpsk_MIX").transition().on("end", function () {
            dwQPSKEnd++;
            completo();
        });


    }

    (function () {
        loading();
        dibujar(false, amp_port.val(), amp_i.val(), amp_q.val(), freq_port.val(), freq_i.val(), freq_q.val());
    })();
</script>
