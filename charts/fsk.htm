<form class="form-panel">
    <div class="row">
        <div class=" col-lg-3 justify-content-center">
            <img src='images/logoUIsrael3.png'/>
        </div>
        <div class=" col-lg-3 justify-content-center">
            <h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE FSK</b></h6>
            <h6 class="text-justify">
                Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide)
                entre dos valores posibles.
            </h6>
            <div class="text-right ">
                <button class="btn btn-labeled btn-primary" id="fskRedraw" type="button">
                    <span class="btn-label"><i class="fa fa-check" id="fskRedrawIcon"></i></span>|graficar
                </button>
            </div>
        </div>

        <div class="col-lg-5 text-center">
            <div class="row label-section-top ">
                <div class="col-lg-3 nopadding text-center">
                    <span class="badge badge-danger">PORTADORA|MODULADORA</span>
                </div>
                <div class="col-lg-6 text-center">
                    <span class="badge badge-success">SEÑAL PORTADORA</span>
                </div>
                <div class="col-lg-3 nopadding text-center">
                    <span class="badge badge-info">SEÑAL MODULADORA</span>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 text-center">
                    <input id="amp_FSK" type="text" value="4"/>
                    <span class="badge badge-danger">Amplitud</span>
                </div>
                <!--SEÑAL PORTADORA-->
                <div class="col-lg-3 text-center">
                    <input id="frec_FSK" type="text" value="20"/>
                    <span class="badge badge-success">Frecuencia</span>
                </div>
                <div class="col-lg-3 text-center">
                    <input id="desv_FSK" type="text" value="10"/>
                    <span class="badge badge-success">Desviacion</span>
                </div>
                <!--SEÑAL MODULADORA-->
                <div class="col-lg-3 text-center">
                    <input id="frecMD_FSK" type="text" value="4"/>
                    <span class="badge badge-info">Frecuencia</span>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 ">

                </div>
                <div class="col-lg-6 text-center nopadding">
                    <span class="badge badge-success fontSize">Freq.Espacio: <span class="badge badge-light fontSize"
                                                                                   id="freEsp_FSK">10Hz</span></span>
                    <span class="badge badge-success fontSize">Freq. Marca: <span class="badge badge-light fontSize"
                                                                                  id="freMarc_FSK">30Hz</span></span>
                </div>
                <div class="col-lg-3 nopadding text-center">
                </div>
            </div>
        </div>
    </div>
</form>

<div class='row trunk-section'>
    <div class='col-lg-10' id='fsk_moduladora'/>
    <div class="col-lg-2">
        <span>
          <h5>Moduladora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>
<div class='row trunk-section'>
    <div class='col-lg-10 ' id='fsk_marca'/>
    <div class="col-lg-2">
        <span>
          <h5>Frecuencia de Marca</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>
<div class='row trunk-section'>
    <div class='col-lg-10 ' id='fsk_portadora'/>
    <div class="col-lg-2">
                <span>
                  <h5>Portadora</h5>
                       <h6 class="text-justify">
                           Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
                       </h6>
                </span>
    </div>
</div>
<div class='row trunk-section'>
    <div class='col-lg-10' id='fsk_espacio'/>
    <div class="col-lg-2">
        <span>
          <h5>Frecuencia de Espacio</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>
<div class='row trunk-section'>
    <div class='col-lg-10' id='fsk_modulada'/>
    <div class="col-lg-2">
        <span>
          <h5>Modulada</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<script>
    'use strict';
    var dwFSKEnd = 0;

    function completo() {

        if (dwFSKEnd = 5) {
            //Completo Imagen
            dismiss();
            $("#fskRedrawIcon").removeClass().addClass('fa fa-check');
        }
    }

    var amp_FSK = $("#amp_FSK");
    var ampMD_FSK = $("#amp_FSK");

    var frec_FSK = $("#frec_FSK");
    var desv_FSK = $("#desv_FSK");
    var freMarc_FSK = $("#freMarc_FSK");
    var freEsp_FSK = $("#freEsp_FSK");


    var frecMD_FSK = $("#frecMD_FSK");


    var dwPortadoraFSK = {
        /*title: "Portadora",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        //data: data,
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [8],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#fsk_portadora',
        x_accessor: 'Tiempo',
        y_accessor: 'Portadora',
        x_label: 'Tiempo',
        y_label: 'Portadora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var dwModuladoraFSK = {
        /*title: "Moduladora",
        description: "El término comunicaciones digitales abarca un área extensa de técnicas de comunicaciones, incluyendo transmisión digital y radio digital. La transmisión digital es la transmisión de pulsos digitales, entre dos o más puntos, de un sistema de comunicación. El radio digital es la transmisión de portadoras analógicas moduladas, en forma digital, entre dos o más puntos de un sistema de comunicación.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [9],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#fsk_moduladora',
        x_accessor: 'Tiempo',
        y_accessor: 'Moduladora',
        x_label: 'Tiempo',
        y_label: 'Moduladora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var dwModuladaFSK = {
        /*title: "Modulada",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [3],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#fsk_modulada',
        x_accessor: 'Tiempo',
        y_accessor: 'Modulada',
        x_label: 'Tiempo',
        y_label: 'Modulada',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var dwEspacioFSK = {
        /*title: "Frecuencia de Espacio",
        description: "La modulación por desplazamiento de fase o PSK es una forma   en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [10],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#fsk_espacio',
        x_accessor: 'Tiempo',
        y_accessor: 'Espacio',
        x_label: 'Tiempo',
        y_label: 'Frecuencia Espacio',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var dwMarcaFSK = {
        /*title: "Frecuencia de Marca",
        description: "Una onda portadora es una onda, generalmente senoidal, modificada en alguno de sus parámetros (amplitud, frecuencia o fase) por una señal de entrada denominada moduladora con el fin de transmitir una información.1​ Esta onda portadora es de una frecuencia mucho más alta que la de la señal moduladora.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [5],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#fsk_marca',
        x_accessor: 'Tiempo',
        y_accessor: 'Marca',
        x_label: 'Tiempo',
        y_label: 'Frecuencia Marca',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };


    var eventoDesv = function (value) {
        updateEspacioMarca();
    };
    var eventoFreq = function (value) {
        updateEspacioMarca();
    };

    function updateEspacioMarca() {
        let freq = parseInt(frec_FSK.val().replace(/Hz|m/g, ""));
        let desv = parseInt(desv_FSK.val().replace(/Hz|m/g, ""));
        freEsp_FSK.text((freq - desv) + "Hz");
        freMarc_FSK.text((freq + desv) + "Hz");
    }


    function dibujar(redibujar, amp, frec, fEspacio, fMarca, ampM, frecM) {
        dwFSKEnd = 0;
        let TiempoMin = 0;
        let TiempoMax = 720;

        let portadora = 0;
        let espacio = 0;
        let marca = 0;
        let moduladora = 0;
        let modulada = 0;
        let dataFSK = [];

        let Tiempo;
        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            portadora = (amp) * SIN(RADIANS(Tiempo * frec)); /// =$B$4*SIN(RADIANS(A11*$B$5))
            espacio = (amp) * SIN(RADIANS(Tiempo * fEspacio));// =$B$4*SIN(RADIANS(A11*$B$7))
            marca = (amp) * SIN(RADIANS(Tiempo * fMarca));// =$B$4*SIN(RADIANS(A11*$B$8))
            moduladora = (ampM) * SIN(RADIANS(frecM * Tiempo)) > 0 ? amp : ((-1) * (amp)); //=IF($F$4*SIN(RADIANS($F$5*A11))>0,F$4,-$F$4)
            modulada = (moduladora) < 0 ? espacio : marca;  //IF(E11<0,C11,D11)

            dataFSK.push({
                "Tiempo": Tiempo,
                "Portadora": portadora,
                "Espacio": marca,
                "Marca": espacio,
                "Moduladora": moduladora,
                "Modulada": modulada
            });
        }

        delete dwPortadoraFSK.data;
        delete dwModuladoraFSK.data;
        delete dwModuladaFSK.data;
        delete dwEspacioFSK.data;
        delete dwMarcaFSK.data;

        dwPortadoraFSK.data = dataFSK;
        dwModuladoraFSK.data = dataFSK;
        dwModuladaFSK.data = dataFSK;
        dwEspacioFSK.data = dataFSK;
        dwMarcaFSK.data = dataFSK;

        MG.data_graphic(dwPortadoraFSK);
        MG.data_graphic(dwModuladoraFSK);
        MG.data_graphic(dwModuladaFSK);
        MG.data_graphic(dwEspacioFSK);
        MG.data_graphic(dwMarcaFSK);


        d3.select("#fsk_moduladora").transition().on("end", function () {
            dwFSKEnd = +1;
            completo();
        });
        d3.select("#fsk_marca").transition().on("end", function () {
            dwFSKEnd = +1;
            completo();
        });
        d3.select("#fsk_portadora").transition().on("end", function () {
            dwFSKEnd = +1;
            completo();
        });
        d3.select("#fsk_espacio").transition().on("end", function () {
            dwFSKEnd = +1;
            completo();
        });
        d3.select("#fsk_modulada").transition().on("end", function () {
            dwFSKEnd = +1;
            completo();
        });
    }

    (function () {
        dibujar(
            false,
            amp_FSK.val().replace(/Hz|m/g, ""),
            frec_FSK.val().replace(/Hz|m/g, ""),
            freEsp_FSK.text().replace(/Hz|m/g, ""),
            freMarc_FSK.text().replace(/Hz|m/g, ""),
            ampMD_FSK.val().replace(/Hz|m/g, ""),
            frecMD_FSK.val().replace(/Hz|m/g, ""));
        $("#amp_FSK").knob(
            confAmpPortadora
        );
        confFrecPortadora.release = eventoFreq;
        $("#frec_FSK").knob(
            confFrecPortadora
        );
        confDesvPortadora.release = eventoDesv;
        $("#desv_FSK").knob(
            confDesvPortadora
        );

        $("#frecMD_FSK").knob(
            confFrecModuladora
        );
    })();

    $('#fskRedraw ').click(function () {
        $("#fskRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(
                false,
                amp_FSK.val().replace(/Hz|m/g, ""),
                frec_FSK.val().replace(/Hz|m/g, ""),
                freEsp_FSK.text().replace(/Hz|m/g, ""),
                freMarc_FSK.text().replace(/Hz|m/g, ""),
                ampMD_FSK.val().replace(/Hz|m/g, ""),
                frecMD_FSK.val().replace(/Hz|m/g, ""))
        }, 10);
    });
</script>
