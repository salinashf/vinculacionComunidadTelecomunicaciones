<form class="form-panel">
    <div class="row">
        <div class=" col-lg-3 justify-content-center">
            <img src='images/logoUIsrael3.png'/>
        </div>
        <div class=" col-lg-4 justify-content-center">
            <h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE PSK</b></h6>
            <h6 class="text-justify">
                Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide)
                entre dos valores posibles.
            </h6>
            <div class="text-right ">
                <button class="btn btn-labeled btn-primary" id="pskRedraw" type="button">
                    <span class="btn-label"><i class="fa fa-check" id="pskRedrawIcon"></i></span>|graficar
                </button>
            </div>
        </div>
        <div class="col-lg-4 text-center">
            <div class="row  label-section-top text-center ">
                <div class=" col-lg-6 text-center">
                    <span class="badge badge-success">SEÑAL PORTADORA</span>
                </div>
                <div class="col-lg-6 text-center">
                    <span class="badge badge-info">SEÑAL MODULADORA</span>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3">
                    <input id="amp_psk_p" type="text" value="2"/>
                    <span class="badge badge-success">Amplitud</span>
                </div>
                <div class="col-sm-3">
                    <input id="freq_psk_p" type="text" value="4"/>
                    <span class="badge badge-success">Frecuencia</span>
                </div>

                <div class="col-sm-3">
                    <input id="amp_psk_m" type="text" value="3"/>
                    <span class="badge badge-info">Amplitud</span>
                </div>
                <div class="col-sm-3">
                    <input id="freq_psk_m" type="text" value="2"/>
                    <span class="badge badge-info">Frecuencia</span>
                </div>

            </div>

        </div>

    </div>
</form>
<div style="overflow-y:scroll;
    overflow-x:hidden;
    height:400px;">

    <div class='row trunk-section'>
        <div class='col-lg-10' id='psk_moduladora'/>
        <div class="col-lg-2">
         <span>
          <h5>Moduladora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>

    <div class='row trunk-section'>
        <div class='col-lg-10' id='psk_portadora'/>
        <div class="col-lg-2">
         <span>
          <h5>Portadora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>

    <div class='row trunk-section'>
        <div class='col-lg-10' id='psk_modulada'/>
        <div class="col-lg-2">
         <span>
          <h5>Modulada</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        </div>
    </div>
</div>
<script>
    'use strict';
    var amp_txt_PSK = $("#amp_psk_p");
    var frec_txt_PSK = $("#freq_psk_p");
    var dat_txt_PSK = $("#amp_psk_m");
    var gd_txt_PSK = $("#freq_psk_m");

    var dwPortadoraPSKEnd = false;
    var dwModuladoraPSKEnd = false;
    var dwModuladaPSKEnd = false;

    var dwPortadoraPSK = {
        /*title: "Portadora",
        description: "Una onda portadora es una onda, generalmente senoidal, modificada en alguno de sus parámetros (amplitud, frecuencia o fase) por una señal de entrada denominada moduladora con el fin de transmitir una información.1​ Esta onda portadora es de una frecuencia mucho más alta que la de la señal moduladora.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [8],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_portadora',
        x_accessor: 'Tiempo',
        y_accessor: 'Portadora',
        x_label: 'Tiempo',
        y_label: 'Portadora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };

    var dwModuladoraPSK = {
        /*title: "Moduladora",
        description: "El término comunicaciones digitales abarca un área extensa de técnicas de comunicaciones, incluyendo transmisión digital y radio digital. La transmisión digital es la transmisión de pulsos digitales, entre dos o más puntos, de un sistema de comunicación. El radio digital es la transmisión de portadoras analógicas moduladas, en forma digital, entre dos o más puntos de un sistema de comunicación.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [9],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_moduladora',
        x_accessor: 'Tiempo',
        y_accessor: 'Moduladora',
        x_label: 'Tiempo',
        y_label: 'Moduladora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };
    var dwModuladaPSK = {
        /*title: "Modulada",
        description: "La modulación por desplazamiento de fase o PSK (Phase Shift Keying) es una forma de ... es continua, en función de la señal moduladora, en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [3],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_modulada',
        x_accessor: 'Tiempo',
        y_accessor: 'Modulada',
        x_label: 'Tiempo',
        y_label: 'Modulada',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };


    (function () {
        dibujar(true);
        $("#amp_psk_p").knob(
            confAmpPortadora
        );
        $("#freq_psk_p").knob(
            confFrecPortadora
        );
        $("#amp_psk_m").knob(
            confAmpModuladora
        );
        $("#freq_psk_m").knob(
            confFrecModuladora
        );


    })();

    $('#pskRedraw ').click(function () {
        $("#pskRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(false)
        }, 10);
    });

    function completo() {
        if (dwModuladaPSKEnd && dwModuladaPSKEnd && dwModuladoraPSKEnd) {
            //Completo Imagen
            dismiss();
            $("#pskRedrawIcon").removeClass().addClass('fa fa-check');
        }
    }

    function dibujar(redibujar) {
        //Cargando Imagen
        let amp, frec, dat, grad;

        amp = amp_txt_PSK.val().replace(/Hz|m/g, "");
        frec = frec_txt_PSK.val().replace(/Hz|m/g, "");
        dat = dat_txt_PSK.val().replace(/Hz|m/g, "");
        grad = gd_txt_PSK.val().replace(/Hz|m/g, "");

        dwPortadoraPSKEnd = false;
        dwModuladoraPSKEnd = false;
        dwModuladaPSKEnd = false;

        let TiempoMin = 0;
        let TiempoMax = 720;
        let portadora = 0;
        let moduladora = 0;
        let moduladaPSK = 0;
        let dataPKS = [];
        let Tiempo;

        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            portadora = (amp) * SIN(RADIANS(Tiempo * frec));
            moduladora = (dat) * SIN(RADIANS(grad * Tiempo)) > 0 ? dat : ((-1) * dat);
            moduladaPSK = portadora * moduladora;
            dataPKS.push({
                "Tiempo": Tiempo,
                "Portadora": portadora,
                "Moduladora": moduladora,
                "Modulada": moduladaPSK
            });

        }
        delete dwPortadoraPSK.data;
        delete dwModuladoraPSK.data;
        delete dwModuladaPSK.data;
        dwPortadoraPSK.data = dataPKS;
        dwModuladoraPSK.data = dataPKS;
        dwModuladaPSK.data = dataPKS;
        MG.data_graphic(dwPortadoraPSK);
        MG.data_graphic(dwModuladoraPSK);
        MG.data_graphic(dwModuladaPSK);

        d3.select("#psk_moduladora").transition().on("end", function () {
            dwModuladoraPSKEnd = true;
            completo();
        });
        d3.select("#psk_portadora").transition().on("end", function () {
            dwPortadoraPSKEnd = true;
            completo();
        });
        d3.select("#psk_modulada").transition().on("end", function () {
            dwModuladaPSKEnd = true;
            completo();
        });
    }
</script>
