<h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE PSK..</b></h6>
<form class="form-panel">
    <div class="row">
        <div class="col-sm-1">
            <label for="amp_B2">Amplitud:</label>
            <input type="number" id="amp_B2" value="2" step="1" min="1" max="50" class="validate form-control "
                   data-validate="required"/>
        </div>
        <div class="col-sm-1">
            <label for="frec_B3">Frecuencia:</label>
            <input type="number" id="frec_B3" value="4" step="1" min="1" max="50" class="validate form-control"
                   data-validate="required"/>
        </div>

        <div class="col-sm-1">
            <label for="dat_F2">Datos :</label>
            <input type="number" id="dat_F2" value="3" step="1" min="1" max="50" class="validate form-control"
                   data-validate="required"/>
        </div>
        <div class="col-sm-1">
            <label for="gd_F3">Grados:</label>
            <input type="number" id="gd_F3" value="2" step="1" min="1" max="50" class="validate form-control"
                   data-validate="required"/>

        </div>
        <div class="col-sm-1">
            <label for="pskRedraw">Regrescar</label>
            <button type="button" id="pskRedraw" class="btn btn-primary  ">
                <span class="btn-label"><i id="pskRedrawIcon" class="glyphicon glyphicon-refresh"></i></span></button>
        </div>
    </div>
</form>

<div class='row trunk-section'>
    <div class='col-lg-10' id='psk_moduladora'/>
    <div class="col-lg-2">
         <span>
          <h5>Moduladora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='psk_portadora'/>
    <div class="col-lg-2">
         <span>
          <h5>Portadora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='psk_modulada'/>
    <div class="col-lg-2">
         <span>
          <h5>Modulada</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>
<script>
    'use strict';
    var amp_txt_PSK = $("#amp_B2");
    var frec_txt_PSK = $("#frec_B3");
    var dat_txt_PSK = $("#dat_F2");
    var gd_txt_PSK = $("#gd_F3");

    var dwPortadoraPSKEnd = false;
    var dwModuladoraPSKEnd = false;
    var dwModuladaPSKEnd = false;

    var dwPortadoraPSK = {
        /*title: "Portadora",
        description: "Una onda portadora es una onda, generalmente senoidal, modificada en alguno de sus parámetros (amplitud, frecuencia o fase) por una señal de entrada denominada moduladora con el fin de transmitir una información.1​ Esta onda portadora es de una frecuencia mucho más alta que la de la señal moduladora.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [8],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_portadora',
        x_accessor: 'Tiempo',
        y_accessor: 'Portadora',
        x_label: 'Tiempo',
        y_label: 'Portadora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };

    var dwModuladoraPSK = {
        /*title: "Moduladora",
        description: "El término comunicaciones digitales abarca un área extensa de técnicas de comunicaciones, incluyendo transmisión digital y radio digital. La transmisión digital es la transmisión de pulsos digitales, entre dos o más puntos, de un sistema de comunicación. El radio digital es la transmisión de portadoras analógicas moduladas, en forma digital, entre dos o más puntos de un sistema de comunicación.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [9],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_moduladora',
        x_accessor: 'Tiempo',
        y_accessor: 'Moduladora',
        x_label: 'Tiempo',
        y_label: 'Moduladora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };
    var dwModuladaPSK = {
        /*title: "Modulada",
        description: "La modulación por desplazamiento de fase o PSK (Phase Shift Keying) es una forma de ... es continua, en función de la señal moduladora, en la PSK la señal moduladora es una señal digital y, por tanto, con un número de estados limitado.",
        width: 900,
        height: 200,
        right: 10,*/
        custom_line_color_map: [3],
        inflator: 1.8,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#psk_modulada',
        x_accessor: 'Tiempo',
        y_accessor: 'Modulada',
        x_label: 'Tiempo',
        y_label: 'Modulada',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        transition_on_update: true,
        area: false
    };


    (function () {
        dibujar(true);
    })();

    $('#pskRedraw ').click(function () {
        $("#pskRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(false)
        }, 10);
    });

    function completo() {
        if (dwModuladaPSKEnd && dwModuladaPSKEnd && dwModuladoraPSKEnd) {
            //Completo Imagen
            dismiss();
            $("#pskRedrawIcon").removeClass().addClass('glyphicon glyphicon-refresh');
        }
    }

    function dibujar(redibujar) {
        //Cargando Imagen
        let amp, frec, dat, grad;

        amp = amp_txt_PSK.val();
        frec = frec_txt_PSK.val();
        dat = dat_txt_PSK.val();
        grad = gd_txt_PSK.val();

        dwPortadoraPSKEnd = false;
        dwModuladoraPSKEnd = false;
        dwModuladaPSKEnd = false;

        let TiempoMin = 0;
        let TiempoMax = 720;
        let portadora = 0;
        let moduladora = 0;
        let moduladaPSK = 0;
        let dataPKS = [];
        let Tiempo;

        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            portadora = (amp) * SIN(RADIANS(Tiempo * frec));
            moduladora = (dat) * SIN(RADIANS(grad * Tiempo)) > 0 ? dat : ((-1) * dat);
            moduladaPSK = portadora * moduladora;
            dataPKS.push({
                "Tiempo": Tiempo,
                "Portadora": portadora,
                "Moduladora": moduladora,
                "Modulada": moduladaPSK
            });

        }
        delete dwPortadoraPSK.data;
        delete dwModuladoraPSK.data;
        delete dwModuladaPSK.data;
        dwPortadoraPSK.data = dataPKS;
        dwModuladoraPSK.data = dataPKS;
        dwModuladaPSK.data = dataPKS;
        MG.data_graphic(dwPortadoraPSK);
        MG.data_graphic(dwModuladoraPSK);
        MG.data_graphic(dwModuladaPSK);

        d3.select("#psk_moduladora").transition().on("end", function () {
            dwModuladoraPSKEnd = true;
            completo();
        });
        d3.select("#psk_portadora").transition().on("end", function () {
            dwPortadoraPSKEnd = true;
            completo();
        });
        d3.select("#psk_modulada").transition().on("end", function () {
            dwModuladaPSKEnd = true;
            completo();
        });
    }
</script>
