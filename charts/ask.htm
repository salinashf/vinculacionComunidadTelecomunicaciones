
<form class="form-panel">
    <div class="row">
        <div class=" col-lg-3 justify-content-center">
            <img src='images/logoUIsrael3.png'/>
        </div>
        <div class=" col-lg-4 justify-content-center">
            <h6><b>MODULACIÓN POR DESPLAZAMIENTO DE FASE ASK</b></h6>
            <h6 class="text-justify">
                Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide)
                entre dos valores posibles.
            </h6>
            <div class="text-right ">
                <button type="button" id="askRedraw" class="label label-primary">graficar
                    <span class="btn-label"><i class="glyphicon glyphicon-ok" id="askRedrawIcon"></i></span></button>
                </button>
            </div>
        </div>

        <div class="col-lg-4 text-center">
            <div class="row">
                <div class="col-lg-3 text-center">
                    <input id="amp_ask_p" type="text" value="1"/>
                    <span class="label label-success">Amplitud</span>
                </div>
                <div class="col-lg-3 text-center">
                    <input id="freq_ask_p" type="text" value="10"/>
                    <span class="label label-success">Frecuencia</span>
                </div>
                <div class="col-lg-3 text-center">
                    <input id="amp_ask_m" type="text" value="5"/>
                    <span class="label label-info">Amplitud</span>
                </div>
                <div class="col-lg-3 text-center">
                    <input id="freq_ask_m" type="text" value="2"/>
                    <span class="label label-info">Frecuencia</span>
                </div>
            </div>

            <div class="row  label-section text-center " >
                <div class=" col-lg-6 text-center">
                    <span class="label label-success">SEÑAL PORTADORA</span>
                </div>
                <div class="col-lg-6 text-center">
                    <span class="label label-info">SEÑAL MODULADORA</span>
                </div>
            </div>
        </div>
    </div>
</form>

<div class='row trunk-section'>
    <div class='col-lg-10' id='ask_moduladora'/>
    <div class="col-lg-2">
        <span>
          <h5>Moduladora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10 ' id='ask_portadora'/>
    <div class="col-lg-2">
         <span>
          <h5>Portadora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>

<div class='row trunk-section'>
    <div class='col-lg-10' id='ask_moduladaASK'/>
    <div class="col-lg-2">
         <span>
          <h5>Modulada</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
    </div>
</div>
<div class='row trunk-section'>
    <div class='col-lg-10' id='ask_moduladaASKMix'/>
    <div class="col-lg-2">
        <span>
          <h5>Portadora/Moduladora</h5>
               <h6 class="text-justify">
                   Forma de modulación digital que consiste en cambiar la amplitud de una onda portadora (una sinusoide) entre dos valores posibles.
               </h6>
        </span>
        <h6 class='text-center' id="legendMix"/>
    </div>
</div>
<script>
    'use strict';


    var dwASKEnd = 0;

    function completo() {
        if (dwASKEnd = 4) {
            //Completo Imagen
            dismiss();
            $("#askRedrawIcon").removeClass().addClass('glyphicon glyphicon-ok');
        }
    }

    var dwModuladoraASK = {
        custom_line_color_map: [9],
        inflator: 1.3,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#ask_moduladora',
        x_accessor: 'Tiempo',
        y_accessor: 'Moduladora',
        x_label: 'Tiempo',
        y_label: 'Moduladora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };

    var dwPortadoraASK = {
        custom_line_color_map: [8],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#ask_portadora',
        x_accessor: 'Tiempo',
        y_accessor: 'Portadora',
        x_label: 'Tiempo',
        y_label: 'Portadora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };


    var dwModuladaASK = {
        custom_line_color_map: [3],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 150,
        right: 1,
        target: '#ask_moduladaASK',
        x_accessor: 'Tiempo',
        y_accessor: 'Modulada',
        x_label: 'Tiempo',
        y_label: 'Modulada',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false
    };
    var varMDPDASK = {
        custom_line_color_map: [8, 9],
        inflator: 1.6,
        missing_is_hidden: true,
        point_size: 4.5,
        active_point_on_lines: true,
        top: 10,
        active_point_size: 10,
        width: 960,
        height: 170,
        right: 1,
        target: '#ask_moduladaASKMix',
        x_accessor: 'Tiempo',
        y_accessor: 'Valor',
        x_label: 'Tiempo',
        y_label: 'Moduladora/Portadora',
        y_extended_ticks: true,
        x_extended_ticks: true,
        animate_on_load: true,
        area: false,
        legend: ['Moduladora', 'Portadora'],
        legend_target: '#legendMix'
    };


    var Ec_txt_ASK = $("#amp_ask_p");
    var fc_txt_ASK = $("#freq_ask_p");
    var Em_txt_ASK = $("#amp_ask_m");
    var fb_txt_ASK = $("#freq_ask_m");

    (function () {
        dibujar(false, Ec_txt_ASK.val(), fc_txt_ASK.val(), Em_txt_ASK.val(), fb_txt_ASK.val());
        $("#amp_ask_p").knob(
            confAmpPortadora
        );
        $("#freq_ask_p").knob(
            confFrecPortadora
        );
        $("#amp_ask_m").knob(
            confAmpModuladora
        );
        $("#freq_ask_m").knob(
            confFrecModuladora
        );


    })();

    $('#askRedraw ').click(function () {
        $("#askRedrawIcon").removeClass().addClass('fa fa-refresh fa-spin');
        loading();
        setTimeout(function () {
            dibujar(false, Ec_txt_ASK.val().replace(/Hz|m/g, ""), fc_txt_ASK.val().replace(/Hz|m/g, ""), Em_txt_ASK.val().replace(/Hz|m/g, ""), fb_txt_ASK.val().replace(/Hz|m/g, ""))
        }, 10);
    });


    function dibujar(redibujar, amp_ask_p, freq_ask_p, amp_ask_m, freq_ask_m) {

        dwASKEnd = 0;
        let TiempoMin = 0;
        let TiempoMax = 720;
        let portadora = 0;
        let moduladora = 0;
        let moduladaASK = 0;
        let dataAKS = [];
        let dataAKSPortadora = [];
        let dataAKSModuladora = [];

        let Tiempo;
        for (Tiempo = TiempoMin; Tiempo <= TiempoMax; Tiempo++) {
            portadora = (amp_ask_p) * (SIN(RADIANS(Tiempo * freq_ask_p)));
            moduladora = (amp_ask_m) * (SIN(RADIANS(freq_ask_m * Tiempo))) > 0 ? 1 : 0;
            moduladaASK = portadora * moduladora;
            //console.log("valores: " + Tiempo + "  " + portadora + "  " + moduladora + "  " + moduladaASK);
            dataAKS.push({
                "Tiempo": Tiempo,
                "Portadora": portadora,
                "Moduladora": moduladora,
                "Modulada": moduladaASK
            });
            dataAKSModuladora.push({
                "Tiempo": Tiempo,
                "Valor": moduladora
            });
            dataAKSPortadora.push({
                "Tiempo": Tiempo,
                "Valor": portadora
            });
        }
        delete dwPortadoraASK.data;
        delete dwModuladoraASK.data;
        delete dwModuladaASK.data;
        delete varMDPDASK.data;
        dwPortadoraASK.data = dataAKS;
        dwModuladoraASK.data = dataAKS;
        dwModuladaASK.data = dataAKS;
        varMDPDASK.data = [dataAKSPortadora, dataAKSModuladora];
        MG.data_graphic(dwPortadoraASK);
        MG.data_graphic(dwModuladoraASK);
        MG.data_graphic(dwModuladaASK);
        MG.data_graphic(varMDPDASK);

        d3.select("#ask_moduladora").transition().on("end", function () {
            dwASKEnd = +1;
            completo();
        });
        d3.select("#ask_portadora").transition().on("end", function () {
            dwASKEnd = +1;
            completo();
        });
        d3.select("#ask_moduladaASK").transition().on("end", function () {
            dwASKEnd = +1;
            completo();
        });
        d3.select("#ask_moduladaASKMix").transition().on("end", function () {
            dwASKEnd = +1;
            completo();
        });
    }
</script>
